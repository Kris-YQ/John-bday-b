
<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
    <title>John. Happy Birthday üéÇ</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Libre+Baskerville:wght@400;700&display=swap" rel="stylesheet">

    <style>
        :root{
          --bg:#0b0f1a;
          --text:#f4f1ea;
          --muted:rgba(244,241,234,.74);
          --shadow: 0 26px 70px rgba(0,0,0,.55);
          --scriptFont: "Great Vibes", cursive;
          --bodyFont: "Libre Baskerville", serif;
          --gold:#d4af37;
          --gold2:#f2df9a;
          --glass: rgba(0,0,0,.18);
          --border: rgba(255,255,255,.14);
          --borderGold: rgba(212,175,55,.55);
        }

        *{ box-sizing:border-box; }
        html, body{
          width:100%;
          height:100%;
          margin:0;
          background: var(--bg);
          overflow:hidden;
          overscroll-behavior:none;
          -webkit-text-size-adjust: 100%;
        }
        body{
          color:var(--text);
          font-family:var(--bodyFont);
          display:flex;
          align-items:center;
          justify-content:center;
          padding: max(12px, env(safe-area-inset-top)) 12px max(12px, env(safe-area-inset-bottom));
        }

        .frame{
          width:min(980px, 96vw);
          height:min(720px, 92dvh);
          position:relative;
          overflow:hidden;
          border:1px solid rgba(255,255,255,.12);
          border-radius:28px;
          box-shadow: var(--shadow);
          background-color: var(--bg);
          background-image:
            radial-gradient(120% 120% at 10% 0%, rgba(212,175,55,.10) 0%, rgba(0,0,0,0) 60%),
            linear-gradient(180deg, rgba(0,0,0,.18), rgba(0,0,0,.45)),
            url("bg.png");
          background-size: cover;
          background-position: center;
          background-repeat: no-repeat;
        }

        @media (max-width: 1024px){
          body{ padding:0; display:block; }
          .frame{
            position:fixed;
            inset:0;
            width:100%;
            height:100dvh;
            border:none;
            border-radius:0;
          }
        }

        .scene{
          position:absolute;
          inset:0;
          display:none;
          overflow:hidden;
          padding: clamp(14px, 2.2vw, 22px);
          padding-top: max(clamp(14px, 2.2vw, 22px), env(safe-area-inset-top));
          padding-bottom: max(clamp(14px, 2.2vw, 22px), env(safe-area-inset-bottom));
        }
        .scene.active{ display:block; }

        .content{
          height:100%;
          display:flex;
          flex-direction:column;
          align-items:center;
          justify-content:flex-start;
          min-height:0;
        }

        .hero{ text-align:center; flex: 0 0 auto; }
        .title{
          font-family:var(--scriptFont);
          font-weight:400;
          margin: 8px 0 2px;
          font-size: clamp(38px, 5.2vw, 70px);
          text-shadow: 0 16px 30px rgba(0,0,0,.35);
          letter-spacing:.2px;
          color: var(--text);
        }
        .subtitle{
          margin: 0;
          color: var(--muted);
          font-size: clamp(12px, 1.6vw, 15px);
          text-shadow: 0 10px 20px rgba(0,0,0,.35);
        }
        .hint{
          margin: 10px 0 0;
          color: rgba(243,241,234,.78);
          font-size: 12px;
          text-shadow: 0 10px 20px rgba(0,0,0,.35);
          text-align:center;
          flex: 0 0 auto;
        }

        /* =======================
           Scene 1 ‚Äî Center stage
           ======================= */
        #scene1 .content{ justify-content:center; }

        #scene1 .centerStage{
          position:relative;
          width:100%;
          height: 78dvh;
          display:flex;
          align-items:center;
          justify-content:center;
        }

        #scene1 .hero{
          position:absolute;
          left:50%;
          top:45%;
          transform: translate(-50%,-50%);
          width: min(92vw, 720px);
          text-align:center;
          margin:0;
          opacity:1;
        }

        #scene1 .title{ margin:0; }
        #scene1 .title .w{
          display:inline-block;
          opacity:0;
          transform: translateY(10px);
          animation: wordIn .9s ease forwards;
          animation-delay: var(--d);
        }
        @keyframes wordIn{
          to{ opacity:1; transform: translateY(0); }
        }

        #scene1.s1-title-out .hero{
          transition: opacity .9s ease, transform .9s ease;
          opacity:0;
          transform: translate(-50%,-58%);
        }

        #scene1 .letter-wrap{
          position:absolute;
          left:50%;
          top:45%;
          transform: translate(-50%,-50%);
          width:100%;
          display:flex;
          align-items:center;
          justify-content:center;
          opacity:0;
          pointer-events:none;
          transition: opacity .8s ease, transform .8s ease;
        }
        #scene1.s1-envelope-in .letter-wrap{
          opacity:1;
          transform: translate(-50%,-50%) scale(1);
          pointer-events:auto;
        }

        #scene1 .hint{
          position:absolute;
          left:50%;
          top: calc(45% + clamp(190px, 28vw, 230px));
          transform: translateX(-50%);
          margin:0;
          opacity:0;
          transition: opacity .8s ease;
        }
        #scene1.s1-envelope-in .hint{ opacity:1; }

        #scene1 .sparkRain{
          position:absolute;
          inset:0;
          pointer-events:none;
          overflow:hidden;
          opacity:0;
        }
        #scene1.s1-spark .sparkRain{ opacity:1; }

        #scene1 .spark{
          position:absolute;
          top:-20px;
          font-size: 14px;
          opacity:0;
          filter: drop-shadow(0 8px 18px rgba(0,0,0,.35));
          animation: fall var(--dur) ease-in forwards;
          animation-delay: var(--delay);
        }
        @keyframes fall{
          0%   { transform: translateY(0) scale(.9) rotate(0deg); opacity:0; }
          15%  { opacity: .9; }
          100% { transform: translateY(var(--dy)) scale(1) rotate(var(--rot)); opacity:0; }
        }

        .envelopeStage{
          position:relative;
          width: min(520px, 88vw);
          aspect-ratio: 711 / 428;
          display:flex;
          align-items:center;
          justify-content:center;
          filter: drop-shadow(0 26px 60px rgba(0,0,0,.55));
          user-select:none;
          -webkit-user-select:none;
        }
        .envelopeStage img{
          width:100%;
          height:100%;
          object-fit:contain;
          display:block;
          filter: contrast(1.06) saturate(1.10) brightness(1.02);
        }
        .waxBtn{
          position:absolute;
          left:50%;
          top:58%;
          transform: translate(-50%,-50%);
          width:92px;
          height:92px;
          border-radius:999px;
          border:1px solid rgba(0,0,0,.22);
          background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.12) 0%, rgba(0,0,0,.02) 50%, rgba(0,0,0,.12) 100%);
          cursor:pointer;
          -webkit-tap-highlight-color: transparent;
        }
        .waxBtn:active{ transform: translate(-50%,-50%) scale(.985); }

        .sparkle{
          position:absolute;
          inset:-50px;
          pointer-events:none;
          opacity:0;
          background: radial-gradient(circle at 50% 55%, rgba(212,175,55,.35), transparent 60%);
        }
        .opened .waxBtn{ animation: crack .55s ease forwards; }
        .opened .sparkle{ animation: glow .9s ease forwards; }

        @keyframes crack{
          0%{transform: translate(-50%,-50%) scale(1); opacity:1}
          70%{transform: translate(-50%,-50%) scale(1.03); opacity:1}
          100%{transform: translate(-50%,-50%) scale(.85); opacity:0}
        }
        @keyframes glow{
          0%{opacity:0}
          40%{opacity:.85}
          100%{opacity:0}
        }

        /* =======================
           Scene 2 ‚Äî no hover, no selected
           ======================= */
        #scene2{
          overflow:auto;
          -webkit-overflow-scrolling: touch;
        }
        #scene2::-webkit-scrollbar{ width:0; height:0; display:none; }

        .cakeCol{
          flex:1;
          width: min(920px, 100%);
          min-height:0;
          display:flex;
          flex-direction:column;
          gap: 12px;
          padding-top: 12px;
        }

        .cakePick{
          width: 100%;
          border:1px solid var(--border);
          background: var(--glass);
          border-radius:18px;
          padding:12px;
          cursor:pointer;
          transition: background .18s ease, transform .12s ease;
          box-shadow: 0 14px 34px rgba(0,0,0,.30);
          overflow:hidden;
          -webkit-tap-highlight-color: transparent;
          text-align:left;
        }
        .cakePick:active{
          transform: scale(.995);
          background: rgba(0,0,0,.22);
        }

        .cakeMedia{
          width:100%;
          border-radius:16px;
          overflow:hidden;
          border:1px solid rgba(255,255,255,.12);
          background: rgba(0,0,0,.12);
          position:relative;
        }
        .cakeMedia::before{ content:""; display:block; padding-top: 62%; }

        .cakeImg{
          position:absolute;
          inset:0;
          width:100%;
          height:100%;
          object-fit: contain;
          padding: 6px;
        }
        .cakeImg--strawberry{
        transform: translateY(-4px) scale(1.04);
        }

        .cakeName{
          margin-top:10px;
          text-align:center;
          font-size: 16px;
          font-weight: 700;
          color: rgba(243,241,234,.92);
          text-shadow: 0 10px 20px rgba(0,0,0,.25);
        }

        /* Scene 3 keep as is */
        .reveal{
          flex:1;
          width:100%;
          min-height:0;
          display:flex;
          align-items:center;
          justify-content:center;
          padding: 6px 0 26px;
        }
        #revealCakeBtn{
          border:none;
          background:transparent;
          padding:0;
          cursor:pointer;
          display:flex;
          flex-direction:column;
          align-items:center;
          -webkit-tap-highlight-color: transparent;
        }
        #revealCakeBtn:active{ transform: scale(.993); }

        .chosenFrame{
          width: min(520px, 92vw);
          border-radius:18px;
          overflow:hidden;
          border:1px solid rgba(255,255,255,.14);
          background: rgba(0,0,0,.12);
          box-shadow: 0 18px 48px rgba(0,0,0,.35);
          position:relative;
        }
        .chosenFrame::before{ content:""; display:block; padding-top: 75%; }
        #chosenCakeImg{
          position:absolute;
          inset:0;
          width:100%;
          height:100%;
          object-fit: contain;
          padding: 10px;
        }

        .modal{
          position:fixed;
          inset:0;
          z-index:9999;
          display:flex;
          align-items:center;
          justify-content:center;
          padding: max(16px, env(safe-area-inset-top)) 16px max(16px, env(safe-area-inset-bottom));
        }
        .modal.hidden{ display:none; }
        .modal-backdrop{
          position:absolute;
          inset:0;
          background: rgba(0,0,0,.22);
          backdrop-filter: blur(12px);
          -webkit-backdrop-filter: blur(12px);
        }
        .modal-card{
          position:relative;
          width:min(680px, 92vw);
          border-radius:22px;
          background:
            radial-gradient(120% 120% at 30% 10%, rgba(212,175,55,.22) 0%, rgba(0,0,0,0) 55%),
            linear-gradient(180deg, rgba(22,12,14,.96), rgba(14,10,14,.96));
          border:1px solid var(--borderGold);
          box-shadow: 0 34px 96px rgba(0,0,0,.55);
          padding: 22px 20px 18px;
          text-align:center;
          transform: translateY(18px) scale(.985);
          opacity:0;
          animation: pop .28s ease forwards;
        }
        @keyframes pop{ to{ transform: translateY(0) scale(1); opacity:1; } }

        .card-title{
          font-size: 26px;
          color: var(--gold2);
          margin-bottom: 10px;
          text-shadow: 0 10px 22px rgba(0,0,0,.35);
        }
        .card-line{
          font-size: 14px;
          line-height: 1.6;
          color: rgba(243,241,234,.94);
        }
        .card-line.soft{
          color: rgba(243,241,234,.82);
          margin-top: 8px;
        }
        .modal-close{
          position:absolute;
          top:12px;
          right:12px;
          width:36px;
          height:36px;
          border-radius:999px;
          border:1px solid rgba(255,255,255,.20);
          background: rgba(0,0,0,.28);
          color: rgba(243,241,234,.92);
          font-size:20px;
          cursor:pointer;
          display:flex;
          align-items:center;
          justify-content:center;
          -webkit-tap-highlight-color: transparent;
        }

        @media (max-width: 640px){
          .title{
            font-size: clamp(30px, 9vw, 44px);
            line-height: 1.05;
          }
        }

        @media (prefers-reduced-motion: reduce){
          *{ animation: none !important; transition: none !important; }
        }

/* Scene3ÔºöÊ†áÈ¢òÂå∫‰∏çË¶ÅÁΩÆÈ°∂ÔºåÊå™Âà∞ËõãÁ≥ïÂõæ‰∏äÊñπ */
#scene3 .content{
  justify-content:center;
}

#scene3 .hero--lower{
  margin-top: 16dvh;         /* ‰∏ãÁßª‰∏ÄÁÇπÔºà‰∏§‰∏âË°åÁöÑÊÑüËßâÔºâ */
  margin-bottom: 12px;       /* ÂíåËõãÁ≥ïÂõæ‰øùÊåÅ‰∏ÄÁÇπË∑ùÁ¶ª */
}
  #scene3 .hero--lower .title{
  margin: 0 0 10px;         /* Ê†áÈ¢ò‰∏ãÊñπÁïôÁ©∫ */
}
  #scene3 .hero--lower .subtitle{
  margin: 0;
  letter-spacing: .2px;
  font-size:15px;
}

/* subtle breathe / glow */
.breathe{
  position: relative;
  display: inline-block;
  color: rgba(244,241,234,.86);
  text-shadow: 0 10px 22px rgba(0,0,0,.30);
  animation: breatheGlow 2.8s ease-in-out infinite;
}

@keyframes breatheGlow{
  0%, 100%{
    opacity: .78;
    transform: translateY(0);
    text-shadow:
      0 10px 22px rgba(0,0,0,.32),
      0 0 0 rgba(212,175,55,0);
  }
  50%{
    opacity: 1;
    transform: translateY(-1px);
    text-shadow:
      0 12px 26px rgba(0,0,0,.34),
      0 0 18px rgba(212,175,55,.35);
  }
}

/* Reduce motion support */
@media (prefers-reduced-motion: reduce){
  .breathe{ animation: none !important; }
}
    </style>
</head>

<body>
<main class="frame">

    <!-- Scene 1 -->
    <section id="scene1" class="scene active">
        <div class="content">
            <div class="centerStage">
                <header class="hero">
                    <h1 class="title" id="title1">John. Happy Birthday üéÇ</h1>
                </header>

                <div id="sparkRain" class="sparkRain" aria-hidden="true"></div>

                <div class="letter-wrap">
                    <div id="envStage" class="envelopeStage" aria-label="envelope stage">
                        <img src="envelope.png" alt="Red envelope with wax seal" />
                        <button id="sealBtn" class="waxBtn" aria-label="open wax seal"></button>
                        <div class="sparkle"></div>
                    </div>
                </div>

                <p class="hint">Tap the wax seal to open.</p>
            </div>
        </div>
    </section>

    <!-- Scene 2 -->
    <section id="scene2" class="scene">
        <div class="content">
            <header class="hero">
                <h1 class="title">John. Happy Birthday üéÇ</h1>
                <p class="subtitle">Choose your birthday cake.</p>
            </header>

            <div class="cakeCol">
                <button class="cakePick" data-id="cakeA" data-name="Classic Chocolate" aria-label="Classic Chocolate">
                    <div class="cakeMedia">
                        <img class="cakeImg" src="cake-chocolate.png" alt="Classic Chocolate" />
                    </div>
                    <div class="cakeName">Classic Chocolate</div>
                </button>

                <button class="cakePick" data-id="cakeB" data-name="Strawberry Cream" aria-label="Strawberry Cream">
                    <div class="cakeMedia">
                        <img class="cakeImg cakeImg--strawberry" src="cake-strawberry.png" alt="Strawberry Cream" />
                    </div>
                    <div class="cakeName">Strawberry Cream</div>
                </button>

                <button class="cakePick" data-id="cakeC" data-name="Matcha Velvet" aria-label="Matcha Velvet">
                    <div class="cakeMedia">
                        <img class="cakeImg" src="cake-matcha.png" alt="Matcha Velvet" />
                    </div>
                    <div class="cakeName">Matcha Velvet</div>
                </button>
            </div>

            <p class="hint">Pick one.</p>
        </div>
    </section>

    <!-- Scene 3 -->
    <section id="scene3" class="scene">
        <div class="content">
            <header class="hero hero--lower">
                <h1 class="title">John. Happy Birthday üéÇ</h1>
                <p class="subtitle">Open your surprise.</p>
            </header>

            <div class="reveal">
                <button id="revealCakeBtn" aria-label="tap cake to reveal surprise">
                    <div class="chosenFrame">
                        <img id="chosenCakeImg" alt="Chosen cake" />
                    </div>
                    <div id="chosenCakeName" class="cakeName"></div>
                </button>
            </div>


        </div>
    </section>

</main>

<!-- Modal -->
<div id="modal" class="modal hidden" role="dialog" aria-modal="true">
    <div class="modal-backdrop"></div>
    <div class="modal-card">
        <button id="modalClose" class="modal-close" aria-label="close">√ó</button>
        <div class="card-title">Congratulations üí´</div>
        <div class="card-line">You‚Äôve unlocked a hidden birthday surprise.</div>
        <div class="card-line soft">
            Unlocking in <span id="countdown">--h --m --s</span> ‚ú®
        </div>
    </div>
</div>

<script>
    const scene1 = document.getElementById("scene1");
    const scene2 = document.getElementById("scene2");
    const scene3 = document.getElementById("scene3");

    const sealBtn = document.getElementById("sealBtn");
    const envStage = document.getElementById("envStage");

    const cakeBtns = Array.from(document.querySelectorAll(".cakePick[data-id]"));
    const chosenCakeImg = document.getElementById("chosenCakeImg");
    const chosenCakeName = document.getElementById("chosenCakeName");
    const revealCakeBtn = document.getElementById("revealCakeBtn");

    const modal = document.getElementById("modal");
    const modalClose = document.getElementById("modalClose");
    const modalBackdrop = modal.querySelector(".modal-backdrop");
    const countdownEl = document.getElementById("countdown");

    const cakeSrc = {
      cakeA: "cake-chocolate.png",
      cakeB: "cake-strawberry.png",
      cakeC: "cake-matcha.png"
    };

    function go(to){
      [scene1, scene2, scene3].forEach(s => s.classList.remove("active"));
      to.classList.add("active");
    }

    // Èò≤Âæ°ÔºöÂ¶ÇÊûúÊ†∏ÂøÉÂÖÉÁ¥†‰∏çÂ≠òÂú®ÔºåÁõ¥Êé•‰∏çË∑ëÔºàÈÅøÂÖçÊï¥ÊÆµ JS Êä•ÈîôÂØºËá¥‚ÄúÂÖ®ÂÅú‚ÄùÔºâ
    function safeInit(){
      if(!scene1 || !scene2 || !scene3) return;
      if(!sealBtn || !envStage) return;

      runScene1Intro();
      restoreChoice();

      sealBtn.addEventListener("click", ()=>{
        envStage.classList.add("opened");
        setTimeout(()=>go(scene2), 650);
      });

      cakeBtns.forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const id = btn.dataset.id;
          const name = btn.dataset.name;

          localStorage.setItem("chosenCakeId", id);
          localStorage.setItem("chosenCakeName", name);

          chosenCakeImg.src = cakeSrc[id];
          chosenCakeName.textContent = name;

          go(scene3);
        });
      });

      if(revealCakeBtn){
        revealCakeBtn.addEventListener("click", ()=>{
          revealCakeBtn.animate(
            [{transform:"scale(1)"},{transform:"scale(.985)"},{transform:"scale(1)"}],
            {duration:160, easing:"ease-out"}
          );
          setTimeout(openModal, 120);
        });
      }

      modalClose.addEventListener("click", closeModal);
      modalBackdrop.addEventListener("click", closeModal);
      window.addEventListener("keydown", (e)=>{ if(e.key==="Escape") closeModal(); });
    }

    document.addEventListener("DOMContentLoaded", safeInit);

    /* Scene 1 intro */
    function runScene1Intro(){
      const titleEl = document.getElementById("title1");
      buildWordSpans(titleEl);

      setTimeout(() => {
        scene1.classList.add("s1-spark");
        startSparkRain(18);
      }, 750);

      const totalMs = getWordAnimTotalMs(titleEl, 520, 900) + 900;

      setTimeout(() => {
        scene1.classList.add("s1-title-out");
      }, totalMs);

      setTimeout(() => {
        scene1.classList.add("s1-envelope-in");
      }, totalMs + 550);
    }

    function buildWordSpans(titleEl){
      const raw = (titleEl?.textContent || "").trim();
      const parts = raw.split(" ");
      titleEl.innerHTML = "";

      const wordDelay = 520;
      parts.forEach((p, i) => {
        const span = document.createElement("span");
        span.className = "w";
        span.textContent = (i === parts.length - 1) ? p : (p + " ");
        span.style.setProperty("--d", `${i * wordDelay}ms`);
        titleEl.appendChild(span);
      });
    }

    function getWordAnimTotalMs(titleEl, wordDelay=520, wordDur=900){
      const count = titleEl.querySelectorAll(".w").length || 1;
      return (count - 1) * wordDelay + wordDur;
    }

    function startSparkRain(count = 18){
      const box = document.getElementById("sparkRain");
      if(!box) return;
      box.innerHTML = "";

      const emojis = ["‚ú®","‚ú¶","‚úß","‚ãÜ"];
      for(let i=0;i<count;i++){
        const s = document.createElement("div");
        s.className = "spark";
        s.textContent = emojis[Math.floor(Math.random()*emojis.length)];

        s.style.left = (Math.random()*100) + "%";
        s.style.setProperty("--dy", (240 + Math.random()*420) + "px");
        s.style.setProperty("--dur", (1.3 + Math.random()*1.4) + "s");
        s.style.setProperty("--rot", (Math.random()*140 - 70).toFixed(0) + "deg");
        s.style.setProperty("--delay", (Math.random()*0.9) + "s");

        box.appendChild(s);
      }
      setTimeout(()=>{ box.innerHTML = ""; }, 5200);
    }

    /* restore choice */
    function restoreChoice(){
      const id = localStorage.getItem("chosenCakeId");
      const name = localStorage.getItem("chosenCakeName");
      if(id && cakeSrc[id] && chosenCakeImg && chosenCakeName){
        chosenCakeImg.src = cakeSrc[id];
        chosenCakeName.textContent = name || "";
      }
    }

    /* modal + countdown */
    let countdownTimer = null;

    function getTargetDate(){
      const now = new Date();
      const y = now.getFullYear();
      let target = new Date(y, 2, 6, 0, 0, 0); // March = 2
      if (now.getTime() > target.getTime()) target = new Date(y + 1, 2, 6, 0, 0, 0);
      return target;
    }
    function formatCountdown(ms){
      if (ms <= 0) return "00h 00m 00s";
      const totalSec = Math.floor(ms / 1000);
      const hours = Math.floor(totalSec / 3600);
      const mins  = Math.floor((totalSec % 3600) / 60);
      const secs  = totalSec % 60;
      const pad = (n) => String(n).padStart(2, "0");
      return `${hours}h ${pad(mins)}m ${pad(secs)}s`;
    }
    function startCountdown(){
      const target = getTargetDate();
      function tick(){
        const msLeft = target.getTime() - Date.now();
        countdownEl.textContent = formatCountdown(msLeft);
        if (msLeft <= 0) stopCountdown();
      }
      tick();
      countdownTimer = setInterval(tick, 1000);
    }
    function stopCountdown(){
      if (countdownTimer) clearInterval(countdownTimer);
      countdownTimer = null;
    }

    function openModal(){
      modal.classList.remove("hidden");
      startCountdown();
    }
    function closeModal(){
      modal.classList.add("hidden");
      stopCountdown();
    }
</script>
</body>
</html>